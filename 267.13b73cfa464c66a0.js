"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[267],{8655:(O,E,p)=>{p.d(E,{V:()=>C});var f=p(177),e=p(5239),r=p(3953);const b=v=>({transform:v});function S(v,P){if(1&v&&(r.j41(0,"ion-text")(1,"p"),r.EFF(2),r.k0s()()),2&v){const a=r.XpG();r.R7$(2),r.JRh(a.model.subTitle)}}let C=(()=>{var v;class P{constructor(){this.fontSize="18rem",this.isMargin="translateY(10vh)"}ngOnInit(){}}return(v=P).\u0275fac=function(y){return new(y||v)},v.\u0275cmp=r.VBU({type:v,selectors:[["app-empty-screen"]],inputs:{model:"model",fontSize:"fontSize",isMargin:"isMargin"},standalone:!0,features:[r.aNF],decls:9,vars:9,consts:[[3,"ngStyle"],[1,"ion-text-center"],[3,"name","color"],[4,"ngIf"]],template:function(y,_){1&y&&(r.j41(0,"ion-grid",0)(1,"ion-row")(2,"ion-col",1),r.nrm(3,"ion-icon",2),r.k0s()(),r.j41(4,"ion-row")(5,"ion-col",1)(6,"ion-label"),r.EFF(7),r.k0s(),r.DNE(8,S,3,1,"ion-text",3),r.k0s()()()),2&y&&(r.Y8G("ngStyle",r.eq3(7,b,_.model.noSpace?"0vh":_.isMargin)),r.R7$(3),r.xc7("font-size",_.fontSize),r.Y8G("name",_.model.icon)("color",_.model.color?_.model.color:"tertiary"),r.R7$(4),r.SpI(" ",_.model.title," "),r.R7$(),r.Y8G("ngIf",null==_.model?null:_.model.subTitle))},dependencies:[e.lO,e.ln,e.hU,e.iq,e.he,e.IO,f.bT,f.B3]}),P})()},9199:(O,E,p)=>{p.d(E,{K:()=>P});var f=p(177),e=p(3953),r=p(5239);function b(a,y){if(1&a&&(e.j41(0,"ion-text",8),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&a){const _=e.XpG();e.R7$(),e.SpI(" ",e.i5U(2,1,null==_.member||null==_.member.gym_plan?null:_.member.gym_plan.expiry_date,"MMM d, y")," ")}}function S(a,y){1&a&&(e.j41(0,"ion-text",8),e.EFF(1," - "),e.k0s())}function C(a,y){if(1&a&&(e.j41(0,"ion-text",8),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&a){const _=e.XpG();e.R7$(),e.SpI(" ",e.i5U(2,1,null==_.member||null==_.member.pt_plan?null:_.member.pt_plan.expiry_date,"MMM d, y")," ")}}function v(a,y){1&a&&(e.j41(0,"ion-text",8),e.EFF(1," - "),e.k0s())}let P=(()=>{var a;class y{constructor(){this.call=new e.bkB}ngOnInit(){}callMember(o){this.call.emit(o)}}return(a=y).\u0275fac=function(o){return new(o||a)},a.\u0275cmp=e.VBU({type:a,selectors:[["app-member"]],inputs:{member:"member"},outputs:{call:"call"},standalone:!0,features:[e.aNF],decls:24,vars:5,consts:[[3,"detail"],["slot","start"],[3,"src"],["slot","end","size","small",1,"call-button",3,"click"],["name","call-outline"],[1,"ion-margin-vertical"],["size","4","offset","3"],["align","center"],["color","dark"],["size","4"]],template:function(o,t){1&o&&(e.j41(0,"ion-card")(1,"ion-item",0)(2,"ion-thumbnail",1),e.nrm(3,"ion-img",2),e.k0s(),e.j41(4,"ion-label"),e.EFF(5),e.nrm(6,"p"),e.k0s(),e.j41(7,"ion-fab-button",3),e.bIt("click",function(){return t.callMember(null==t.member?null:t.member.phone)}),e.nrm(8,"ion-icon",4),e.k0s()(),e.j41(9,"ion-row",5)(10,"ion-col",6)(11,"div",7)(12,"ion-label"),e.EFF(13,"Plan Expiry"),e.k0s(),e.j41(14,"p"),e.DNE(15,b,3,4,"ion-text",8)(16,S,2,0,"ion-text",8),e.k0s()()(),e.j41(17,"ion-col",9)(18,"div",7)(19,"ion-label"),e.EFF(20,"PT Plan Expiry"),e.k0s(),e.j41(21,"p"),e.DNE(22,C,3,4,"ion-text",8)(23,v,2,0,"ion-text",8),e.k0s()()()()()),2&o&&(e.R7$(),e.Y8G("detail",!0),e.R7$(2),e.Y8G("src",null==t.member?null:t.member.photo),e.R7$(2),e.SpI(" ",(null==t.member?null:t.member.name)+" ("+(null==t.member?null:t.member.serial_no)+")"," "),e.R7$(10),e.vxM(null!=t.member&&t.member.gym_plan?15:16),e.R7$(7),e.vxM(null!=t.member&&t.member.pt_plan?22:23))},dependencies:[r.iq,r.YW,r.uz,r.KW,r.ln,r.hU,r.he,r.IO,r.b_,r.Zx,f.vh],styles:["ion-card[_ngcontent-%COMP%]{height:22vh}ion-card[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{transform:translateY(100%)}ion-card[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:1rem;font-weight:700}ion-card[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem;margin-top:5px;font-weight:400}ion-card[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{width:4rem;height:4rem}ion-card[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{height:100%;width:100%;border-radius:8px}ion-fab-button.call-button[_ngcontent-%COMP%]{height:1.5rem;width:1.5rem}ion-fab-button.call-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:.9rem}"]}),y})()},1583:(O,E,p)=>{p.d(E,{m:()=>P});var f=p(467),e=p(9642),r=p(3953),b=p(9967),S=p(4412),C=p(1985),v=p(1339);let P=(()=>{var a;class y{get registerForm(){return this._registerForm.asObservable()}get students(){return this._students.asObservable()}get member(){return this._member.asObservable()}constructor(){this.expiry_days_count=365,this._registerForm=new S.t(0),this._students=new S.t([]),this._member=new S.t(null),this.apiService=(0,r.WQX)(e.G),this.auth=(0,r.WQX)(v.u)}updateFormValue(o){this._registerForm.next(o)}uploadPhoto(o,t){var i=this;return(0,f.A)(function*(){try{const n=Date.now();console.log(t);const l=`students/${n}.${o.format}`;return yield i.apiService.uploadImage(t,l)}catch(n){throw n}})()}registerStudent(o,t,i){var n=this;return(0,f.A)(function*(){try{const l=n.apiService.collectionFirestoreRef("students"),m=(0,b.P)(l,(0,b.or)(n.apiService.whereQuery("email","==",null==o?void 0:o.email),n.apiService.whereQuery("phone","==",null==o?void 0:o.phone))),u=yield(yield n.apiService.getDocsByQuery(m)).docs.map(M=>M.data());if((null==u?void 0:u.length)>0)throw{code:"exists",message:"Student already registered with same email or phone number"};const c=yield n.uploadPhoto(t,i),h={...o,photo:c},s=yield n.apiService.addDocument("students",h);let g=[{...h,id:null==s?void 0:s.id},...n._students.value];return n._students.next(g),s}catch(l){throw l}})()}getStudents(o,t,i){var n=this;return(0,f.A)(function*(){try{if(!(yield n.auth.getId()))throw"Unauthorized user";i||(n.lastVisible=null);const m=n.apiService.collectionFirestoreRef("students");let d=(0,b.P)(m,n.apiService.orderByQuery("created_at","desc"),n.apiService.limitQuery(o));t&&(d=(0,b.P)(d,n.apiService.whereQuery("short_name",">=",t),n.apiService.whereQuery("short_name","<=",t+"\uf8ff"))),n.lastVisible&&i&&(d=(0,b.P)(d,n.apiService.startAfterQuery(n.lastVisible)));const u=yield n.apiService.getDocsByQuery(d);console.log(u);let c=[];u.docs.length>0&&(n.lastVisible=u.docs[u.docs.length-1],console.log("last",n.lastVisible),c=yield u.docs.map(s=>{let g=s.data();return g.id=s.id,g}));let h=[];return i?(console.log("orders",c),h=n._students.value||[],h=h.concat(c)):h=[...c],n._students.next(h),h}catch(l){throw l}})()}getStudentsCount(){var o=this;return(0,f.A)(function*(){try{return(yield o.apiService.getDocs("students")).size}catch(t){throw t}})()}getStudent(o){var t=this;return(0,f.A)(function*(){try{const i=yield t.apiService.getDocById(`students/${o}`);if(i.exists()){let n=i.data();return n.id=i.id,t._member.next(n),n}throw console.log("No such document!"),"No such document!"}catch(i){throw i}})()}updateMember(o,t,i,n){var l=this;return(0,f.A)(function*(){try{if(i){const c=yield l.uploadPhoto(i,n);t={...t,photo:c}}const m=yield l.apiService.updateDocument(`students/${o.id}`,t);console.log(m);let d=l._students.value||[];if(0==(null==d?void 0:d.length)){let c=l._member.value;return console.log("member data: ",c),c?(c={...c,...t},l._member.next(c),{...c,...t}):null}const u=d.findIndex(c=>c.id==o.id);return-1==u?null:(d[u]={...d[u],...t},l._students.next(d),l._member.next(d[u]),{...d[u]})}catch(m){throw m}})()}updateMemberValue(o,t=!0){const i=this._students.value;let n;if((null==i?void 0:i.length)>0){const l=i.findIndex(m=>m.id==(null==o?void 0:o.id));if(-1==l)return;i[l]={...i[l],...o},this._students.next(i),n=i[l]}else{if(n=this._member.value,!n)return;n={...n,...o}}t&&this._member.next(n)}updateMemberData(o,t){const i=this._students.value;let n;if(0==(null==i?void 0:i.length)){if(n=this._member.value,!n)return}else n=i.find(m=>m.id==o);const l={...n,...t};this._member.next(l),this.updateMemberValue(l,!1)}resetMember(){this._member.next(null)}getMemberData(o){var t=this;return(0,f.A)(function*(){try{let i=t._member.value;return i||(i=yield t.getStudent(o)),i}catch(i){throw i}})()}fetchMembersWithExpiringPlans(){return new C.c(o=>{const t=(new Date).toISOString(),i=new Date;i.setDate(i.getDate()+this.expiry_days_count);const n=i.toISOString(),l=this.apiService.collectionFirestoreRef("students"),m=(0,b.P)(l,this.apiService.whereQuery("gym_plan.expiry_date","<=",n),this.apiService.whereQuery("pt_plan.expiry_date","<=",n));return(0,b.aQ)(m,u=>{const c=[];u.docs.forEach(h=>{const s=h.data(),g=h.id,M=[];null!=s&&s.gym_plan&&s.gym_plan.expiry_date>=t&&s.gym_plan.expiry_date<=n&&M.push("GYM"),null!=s&&s.pt_plan&&(s.pt_plan.expiry_date>=t&&s.pt_plan.expiry_date<=n||s.pt_plan.sessions-s.pt_plan.sessions_used==0)&&M.push("PT"),M.length>0&&c.push({id:g,...s,expiringPlans:M})}),console.log(c),o.next(c)},u=>o.error(u))})}fetchMembersWithExpiredGymPlans(){var o=this;return(0,f.A)(function*(){try{const t=(new Date).toISOString(),i=o.apiService.collectionFirestoreRef("students"),n=(0,b.P)(i,o.apiService.whereQuery("gym_plan.expiry_date","<",t)),l=yield o.apiService.getDocsByQuery(n),m=[];return l.forEach(d=>{const u=d.data();m.push({id:d.id,...u})}),console.log(m),m}catch(t){throw console.error(t),t}})()}fetchMembersWithExpiredOrUsedUpPTPlans(){var o=this;return(0,f.A)(function*(){try{const t=(new Date).toISOString(),i=o.apiService.collectionFirestoreRef("students"),n=(0,b.P)(i,o.apiService.whereQuery("pt_plan.expiry_date","<=",t),o.apiService.whereQuery("pt_plan.sessions",">=",0)),l=yield o.apiService.getDocsByQuery(n),m=[];return l.forEach(d=>{var u,c,h;const s=d.data();(null==s?void 0:s.pt_plan)&&((null==s||null===(u=s.pt_plan)||void 0===u?void 0:u.expiry_date)<=t||(null==s||null===(c=s.pt_plan)||void 0===c?void 0:c.sessions)-(null==s||null===(h=s.pt_plan)||void 0===h?void 0:h.sessions_used)==0)&&m.push({id:d.id,...s})}),console.log(m),m}catch(t){throw console.error(t),t}})()}getDaysLeft(o){const t=new Date(o),i=new Date;t.setHours(0,0,0,0),i.setHours(0,0,0,0);const n=new Date;if(n.setDate(i.getDate()+this.expiry_days_count),i<=t&&t<=n){const l=t.getTime()-i.getTime();return Math.ceil(l/864e5)}return null}}return(a=y).\u0275fac=function(o){return new(o||a)},a.\u0275prov=r.jDH({token:a,factory:a.\u0275fac,providedIn:"root"}),y})()}}]);