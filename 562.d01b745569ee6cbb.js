"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[562],{3562:(R,E,f)=>{f.d(E,{u:()=>s});var _=f(467),T=f(177),e=f(3953),c=f(4341),p=f(5239),g=f(9685),A=f(3202),P=f(2109);function D(t,i){1&t&&e.nrm(0,"ion-datetime",34),2&t&&e.Y8G("showDefaultButtons",!0)}function C(t,i){1&t&&(e.j41(0,"div",22),e.EFF(1,"* Please select gender"),e.k0s())}function $(t,i){if(1&t&&(e.j41(0,"ion-select-option",24),e.EFF(1),e.k0s()),2&t){const a=i.$implicit;e.Y8G("value",null==a?null:a.id),e.R7$(),e.JRh(null==a?null:a.name)}}function y(t,i){1&t&&(e.j41(0,"div",22),e.EFF(1,"* Please select training type"),e.k0s())}function k(t,i){if(1&t&&(e.j41(0,"ion-select-option",24),e.EFF(1),e.nI1(2,"timestampToDate"),e.nI1(3,"date"),e.nI1(4,"timestampToDate"),e.nI1(5,"date"),e.k0s()),2&t){const a=i.$implicit;e.Y8G("value",null==a?null:a.id),e.R7$(),e.E5c(" ",null==a?null:a.name," (",e.i5U(3,6,e.bMT(2,4,null==a?null:a.start_time),"hh:mm a")," - ",e.i5U(5,11,e.bMT(4,9,null==a?null:a.end_time),"hh:mm a"),") ")}}function S(t,i){1&t&&(e.j41(0,"div",22),e.EFF(1,"* Please select batch"),e.k0s())}function u(t,i){if(1&t&&e.nrm(0,"img",8),2&t){const a=e.XpG();e.Y8G("src","data:image/png;base64,"+a.aadhar.base64String,e.B4B)}}function d(t,i){1&t&&e.nrm(0,"ion-icon",31)}function o(t,i){if(1&t){const a=e.RV6();e.j41(0,"ion-button",35),e.bIt("click",function(){e.eBV(a);const r=e.XpG();return e.Njj(r.onSubmit())}),e.j41(1,"ion-text"),e.EFF(2,"SAVE"),e.k0s()()}}function n(t,i){1&t&&(e.j41(0,"ion-button",33),e.nrm(1,"ion-spinner",36),e.k0s())}let s=(()=>{var t;class i{constructor(){this.skills=[],this.batches=[],this.close=new e.bkB,this.isSave=!1,this.global=(0,e.WQX)(A.d),this.trainerService=(0,e.WQX)(P.j)}ngOnInit(){this.initForm()}initForm(){var l,r,m,h,v,b,F,M,j,B;this.form=new c.gE({name:new c.MJ((null===(l=this.trainer)||void 0===l?void 0:l.name)||null,{validators:[c.k0.required]}),status:new c.MJ(!this.trainer||(null===(r=this.trainer)||void 0===r?void 0:r.status),{validators:[c.k0.required]}),email:new c.MJ((null===(m=this.trainer)||void 0===m?void 0:m.email)||null,{validators:[c.k0.required,c.k0.email]}),phone:new c.MJ((null===(h=this.trainer)||void 0===h?void 0:h.phone)||null,{validators:[c.k0.required,c.k0.minLength(10),c.k0.maxLength(10)]}),dob:new c.MJ(null!==(v=this.trainer)&&void 0!==v&&v.dob?this.global.toIsoDateTime(new Date(null===(b=this.trainer)||void 0===b?void 0:b.dob)):null,{validators:[c.k0.required]}),gender:new c.MJ((null===(F=this.trainer)||void 0===F?void 0:F.gender)||null,{validators:[c.k0.required]}),address:new c.MJ((null===(M=this.trainer)||void 0===M?void 0:M.address)||null,{validators:[c.k0.required]}),training_type:new c.MJ((null===(j=this.trainer)||void 0===j?void 0:j.training_type)||null,{validators:[c.k0.required]}),batches:new c.MJ((null===(B=this.trainer)||void 0===B?void 0:B.batches)||null,{validators:[c.k0.required]})})}takePicture(){var l=this;return(0,_.A)(function*(){l.photo=yield l.global.takePicture(!0)})()}takeAadharPicture(){var l=this;return(0,_.A)(function*(){l.aadhar=yield l.global.takePicture(!0)})()}dismiss(l){this.close.emit(l)}onSubmit(){this.form.valid?this.trainer||this.photo?this.save():this.global.errorToast("Upload your photo"):this.form.markAllAsTouched()}save(){var l=this;return(0,_.A)(function*(){try{l.isSave=!0;const r=new Date;let m;if(l.trainer){const h={updated_at:r,...l.form.value};m=yield l.trainerService.updateTrainer(l.trainer,h,l.photo,l.aadhar)}else{const h={...l.form.value,type:"trainer",created_at:r,updated_at:r};m=yield l.trainerService.addTrainer(h,l.photo,l.aadhar)}console.log(m),l.isSave=!1,l.dismiss(m)}catch(r){console.log(r),l.isSave=!1,l.global.checkMessageForErrorToast(r)}})()}}return(t=i).\u0275fac=function(l){return new(l||t)},t.\u0275cmp=e.VBU({type:t,selectors:[["app-add-trainer"]],inputs:{skills:"skills",batches:"batches",trainer:"trainer"},outputs:{close:"close"},standalone:!0,features:[e.aNF],decls:74,vars:14,consts:[["color","secondary"],["slot","start"],[3,"click"],["name","arrow-back"],["color","primary",3,"fullscreen"],[3,"formGroup"],["lines","none",1,"ion-margin","pic"],["slot","end",3,"click"],[3,"src"],[1,"form-row"],["sizeLg","6","sizeMd","6","sizeSm","12","sizeXl","6","sizeXs","12"],[1,"col-input"],["label","NAME","labelPlacement","floating","type","text","formControlName","name","errorText","* Please enter proper name."],["label","EMAIL","labelPlacement","floating","formControlName","email","type","email",3,"errorText"],["label","PHONE","labelPlacement","floating","formControlName","phone","type","number",3,"errorText"],["lines","none"],["slot","end","datetime","datetime"],[3,"keepContentsMounted"],["label","GENDER","labelPlacement","fixed","formControlName","gender","interface","popover","placeholder","Select Gender"],["value","M"],["value","F"],["value","T"],[1,"error"],["label","TRAINING TYPE","labelPlacement","fixed","formControlName","training_type","placeholder","Select Trainer Type",3,"multiple"],[3,"value"],["label","SELECT BATCHES ALLOTED","labelPlacement","fixed","formControlName","batches","placeholder","Select batch alloted",3,"multiple"],["lines","none",1,"col-input"],["labelPlacement","start","formControlName","status"],["label","ADDRESS","labelPlacement","floating","rows","1","formControlName","address","errorText","* Please provide your address",3,"autoGrow"],["lines","none",1,"ion-margin","ion-padding-bottom","pic"],["slot","end",1,"aadhar",3,"click"],["name","create-outline","color","tertiary"],[1,"ion-margin"],["expand","block","size","large","shape","round","color","tertiary"],["id","datetime","presentation","date","formControlName","dob",3,"showDefaultButtons"],["expand","block","size","large","shape","round","color","tertiary",3,"click"],["name","crescent","color","light"]],template:function(l,r){1&l&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e.EFF(3,"Add Trainer"),e.k0s(),e.j41(4,"ion-buttons",1)(5,"ion-button",2),e.bIt("click",function(){return r.dismiss()}),e.nrm(6,"ion-icon",3),e.k0s()()()(),e.j41(7,"ion-content",4)(8,"ion-card")(9,"form",5)(10,"ion-item",6)(11,"ion-label"),e.EFF(12," Take a selfie "),e.j41(13,"p"),e.EFF(14,"Your photo is needed for face recognition"),e.k0s()(),e.j41(15,"ion-thumbnail",7),e.bIt("click",function(){return r.takePicture()}),e.nrm(16,"img",8),e.k0s()(),e.j41(17,"ion-row",9)(18,"ion-col",10)(19,"div",11),e.nrm(20,"ion-input",12),e.k0s()(),e.j41(21,"ion-col",10)(22,"div",11),e.nrm(23,"ion-input",13),e.k0s()(),e.j41(24,"ion-col",10)(25,"div",11),e.nrm(26,"ion-input",14),e.k0s()(),e.j41(27,"ion-col",10)(28,"ion-item",15)(29,"ion-label"),e.EFF(30,"Date of Birth"),e.k0s(),e.nrm(31,"ion-datetime-button",16),e.j41(32,"ion-modal",17),e.DNE(33,D,1,1,"ng-template"),e.k0s()()(),e.j41(34,"ion-col",10)(35,"div",11)(36,"ion-select",18)(37,"ion-select-option",19),e.EFF(38,"Male"),e.k0s(),e.j41(39,"ion-select-option",20),e.EFF(40,"Female"),e.k0s(),e.j41(41,"ion-select-option",21),e.EFF(42,"Transgender"),e.k0s()(),e.DNE(43,C,2,0,"div",22),e.k0s()(),e.j41(44,"ion-col",10)(45,"div",11)(46,"ion-select",23),e.Z7z(47,$,2,2,"ion-select-option",24,e.Vm6),e.k0s(),e.DNE(49,y,2,0,"div",22),e.k0s()(),e.j41(50,"ion-col",10)(51,"div",11)(52,"ion-select",25),e.Z7z(53,k,6,14,"ion-select-option",24,e.Vm6),e.k0s(),e.DNE(55,S,2,0,"div",22),e.k0s()(),e.j41(56,"ion-col",10)(57,"ion-item",26)(58,"ion-toggle",27),e.EFF(59,"Status"),e.k0s()()(),e.j41(60,"ion-col",10)(61,"div",11),e.nrm(62,"ion-textarea",28),e.k0s()()(),e.j41(63,"ion-item",29)(64,"ion-label"),e.EFF(65," Upload Aadhar Card "),e.j41(66,"p"),e.EFF(67,"You can upload it later also (if not available now)"),e.k0s()(),e.j41(68,"ion-thumbnail",30),e.bIt("click",function(){return r.takeAadharPicture()}),e.DNE(69,u,1,1,"img",8)(70,d,1,0,"ion-icon",31),e.k0s()()(),e.j41(71,"div",32),e.DNE(72,o,3,0,"ion-button",33)(73,n,2,0,"ion-button",33),e.k0s()()()),2&l&&(e.R7$(7),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("formGroup",r.form),e.R7$(7),e.Y8G("src",r.photo?"data:image/png;base64,"+r.photo.base64String:"assets/imgs/avatar.png",e.B4B),e.R7$(7),e.Y8G("errorText",r.form.get("email").hasError("email")?"* Please enter proper email address.":"* Please enter your Email Address"),e.R7$(3),e.Y8G("errorText",r.form.get("phone").hasError("minlength")||r.form.get("phone").hasError("maxlength")?"* Please enter your 10 digits Phone number.":"* Please enter your Phone number"),e.R7$(6),e.Y8G("keepContentsMounted",!0),e.R7$(11),e.vxM(r.form.get("gender").touched&&r.form.get("gender").hasError("required")?43:-1),e.R7$(3),e.Y8G("multiple",!0),e.R7$(),e.Dyx(r.skills),e.R7$(2),e.vxM(r.form.get("training_type").touched&&r.form.get("training_type").hasError("required")?49:-1),e.R7$(3),e.Y8G("multiple",!0),e.R7$(),e.Dyx(r.batches),e.R7$(2),e.vxM(r.form.get("batches").touched&&r.form.get("batches").hasError("required")?55:-1),e.R7$(7),e.Y8G("autoGrow",!0),e.R7$(7),e.vxM(r.aadhar?69:70),e.R7$(3),e.vxM(r.isSave?73:72))},dependencies:[p.BY,p.w2,p.IO,p.b_,p.ln,p.$w,p.uz,p.he,p.K4,p.A9,p.Sb,p.hU,p.iq,p.Jm,p.QW,p.W9,p.BC,p.ai,p.eU,p.Nm,p.nc,p.Zx,p.Ip,c.X1,c.qT,c.BC,c.cb,c.j4,c.JD,g.i,T.vh],styles:["ion-button[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-size:1rem}ion-thumbnail.aadhar[_ngcontent-%COMP%]{background-color:var(--ion-color-light);border-radius:10px;display:flex;align-items:center;justify-content:center}"]}),i})()},9685:(R,E,f)=>{f.d(E,{i:()=>T});var _=f(3953);let T=(()=>{var e;class c{transform(g){return g?null!=g&&g.seconds?new Date(1e3*(g.seconds||0)+(g.nanoseconds||0)/1e6):g:null}}return(e=c).\u0275fac=function(g){return new(g||e)},e.\u0275pipe=_.EJ8({name:"timestampToDate",type:e,pure:!0,standalone:!0}),c})()},2109:(R,E,f)=>{f.d(E,{j:()=>$});var _=f(467),T=f(3953),e=f(4412),c=f(9350),g=f(9642),A=f(9967),P=f(3202),D=f(1626),C=f(5312);let $=(()=>{var y;class k{get trainers(){return this._trainers.asObservable()}constructor(){this._trainers=new e.t([]),this.http=(0,T.WQX)(D.Qq),this.apiService=(0,T.WQX)(g.G),this.global=(0,T.WQX)(P.d)}getAllTrainers(){var u=this;return(0,_.A)(function*(){try{const d=u.apiService.collectionFirestoreRef("users"),o=(0,A.P)(d,u.apiService.whereQuery("type","==","trainer")),s=yield(yield u.apiService.getDocsByQuery(o)).docs.map(t=>{let i=t.data();return i.id=t.id,i});return console.log("orders",s),s}catch(d){throw d}})()}getTrainers(u,d){var o=this;return(0,_.A)(function*(){try{const n=o.apiService.collectionFirestoreRef("users");let s=(0,A.P)(n,o.apiService.whereQuery("type","==","trainer"),o.apiService.orderByQuery("created_at","asc"),o.apiService.limitQuery(u));o.lastVisible&&d&&(s=(0,A.P)(s,o.apiService.startAfterQuery(o.lastVisible)));const t=yield o.apiService.getDocsByQuery(s);let i=[];t.docs.length>0&&(o.lastVisible=t.docs[t.docs.length-1],console.log("last",o.lastVisible),i=yield t.docs.map(l=>{let r=l.data();return r.id=l.id,r})),console.log("orders",i);let a=o._trainers.value||[];return a=a.concat(i),o._trainers.next(a),a}catch(n){throw n}})()}getTrainer(u){var d=this;return(0,_.A)(function*(){try{const o=yield d.apiService.getDocById(`users/${u}`);if(o.exists()){let n=o.data();if(n.id=o.id,Array.isArray(n.training_type)&&n.training_type.length>0){const s=yield Promise.all(n.training_type.map(function(){var t=(0,_.A)(function*(i){const a=yield d.apiService.getDocById(`skills/${i}`);return a.exists()?{id:i,...a.data()}:(console.log(`No document found for training type id: ${i}`),null)});return function(i){return t.apply(this,arguments)}}()));n.training_type_details=s.filter(t=>null!==t)}if(Array.isArray(n.batches)&&n.batches.length>0){const s=yield Promise.all(n.batches.map(function(){var t=(0,_.A)(function*(i){const a=yield d.apiService.getDocById(`batches/${i}`);return a.exists()?{id:i,...a.data()}:(console.log(`No document found for batch id: ${i}`),null)});return function(i){return t.apply(this,arguments)}}()));n.batch_details=s.filter(t=>null!==t)}return n}throw console.log("No such document!"),"No such document!"}catch(o){throw o}})()}getSkills(){var u=this;return(0,_.A)(function*(){try{const o=yield(yield u.apiService.getDocs("skills")).docs.map(n=>{let s=n.data();return s.id=n.id,s});return console.log("skills",o),o}catch(d){throw d}})()}getBatches(){var u=this;return(0,_.A)(function*(){try{const o=yield(yield u.apiService.getDocs("batches")).docs.map(n=>{let s=n.data();return s.id=n.id,s});return console.log("batches",o),o}catch(d){throw d}})()}registerUser(u,d){var o=this;return(0,_.A)(function*(){try{const n=o.http.post(`https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=${C.c.firebase.apiKey}`,{email:u,password:d}),s=yield function p(y,k){const S="object"==typeof k;return new Promise((u,d)=>{let n,o=!1;y.subscribe({next:s=>{n=s,o=!0},error:d,complete:()=>{o?u(n):S?u(k.defaultValue):d(new c.G)}})})}(n);return console.log("registered user: ",s),null==s?void 0:s.localId}catch(n){throw n}})()}addTrainer(u,d,o){var n=this;return(0,_.A)(function*(){try{const s=n.global.getBlob(d.base64String),t=yield n.uploadPhoto(d,s);let i={...u,photo:t};if(o){const m=n.global.getBlob(null==o?void 0:o.base64String),h=yield n.uploadPhoto(o,m);i={...i,aadhar:h}}const a=yield n.registerUser(i.email,i.phone),l=yield n.apiService.setDocument(`users/${a}`,i);if(Array.isArray(i.training_type)&&i.training_type.length>0){const m=yield Promise.all(i.training_type.map(function(){var h=(0,_.A)(function*(v){const b=yield n.apiService.getDocById(`skills/${v}`);return b.exists()?{id:v,...b.data()}:(console.log(`No document found for training type id: ${v}`),null)});return function(v){return h.apply(this,arguments)}}()));i.training_type_details=m.filter(h=>null!==h)}if(Array.isArray(i.batches)&&i.batches.length>0){const m=yield Promise.all(i.batches.map(function(){var h=(0,_.A)(function*(v){const b=yield n.apiService.getDocById(`batches/${v}`);return b.exists()?{id:v,...b.data()}:(console.log(`No document found for batch id: ${v}`),null)});return function(v){return h.apply(this,arguments)}}()));i.batch_details=m.filter(h=>null!==h)}let r=[{...i,id:a}];return r=r.concat(n._trainers.value),n._trainers.next(r),l}catch(s){throw s}})()}updateTrainer(u,d,o,n){var s=this;return(0,_.A)(function*(){try{let t={...d};if(o){const r=s.global.getBlob(o.base64String),m=yield s.uploadPhoto(o,r);t={...t,photo:m}}if(n){const r=s.global.getBlob(null==n?void 0:n.base64String),m=yield s.uploadPhoto(n,r);t={...t,aadhar:m}}if(yield s.apiService.updateDocument(`users/${null==u?void 0:u.id}`,t),Array.isArray(t.training_type)&&t.training_type.length>0){const r=yield Promise.all(t.training_type.map(function(){var m=(0,_.A)(function*(h){const v=yield s.apiService.getDocById(`skills/${h}`);return v.exists()?{id:h,...v.data()}:(console.log(`No document found for training type id: ${h}`),null)});return function(h){return m.apply(this,arguments)}}()));t.training_type_details=r.filter(m=>null!==m)}if(Array.isArray(t.batches)&&t.batches.length>0){const r=yield Promise.all(t.batches.map(function(){var m=(0,_.A)(function*(h){const v=yield s.apiService.getDocById(`batches/${h}`);return v.exists()?{id:h,...v.data()}:(console.log(`No document found for batch id: ${h}`),null)});return function(h){return m.apply(this,arguments)}}()));t.batch_details=r.filter(m=>null!==m)}let a=s._trainers.value;if(0==(null==a?void 0:a.length))return{...u,...t};const l=a.findIndex(r=>r.id==u.id);return-1==l?null:(a[l]={...a[l],...t},s._trainers.next(a),a[l])}catch(t){throw t}})()}uploadPhoto(u,d){var o=this;return(0,_.A)(function*(){try{const n=Date.now();console.log(d);const s=`trainers/${n}.${u.format}`;return yield o.apiService.uploadImage(d,s)}catch(n){throw n}})()}}return(y=k).\u0275fac=function(u){return new(u||y)},y.\u0275prov=T.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),k})()}}]);