"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[226],{9226:(O,D,y)=>{y.r(D),y.d(D,{StudentRegisterPage:()=>M});var S=y(467),e=y(3953),u=y(5239),r=y(4341),P=y(8976),E=y(1583),x=y(6298);function T(a,v){1&a&&e.nrm(0,"ion-datetime",32),2&a&&e.Y8G("showDefaultButtons",!0)}function k(a,v){1&a&&(e.j41(0,"div",15),e.EFF(1,"* Please select gender"),e.k0s())}function R(a,v){1&a&&(e.j41(0,"div",15),e.EFF(1,"* Please select height"),e.k0s())}function j(a,v){1&a&&(e.j41(0,"div",15),e.EFF(1,"* Please select membership type"),e.k0s())}let l=(()=>{var a;class v{constructor(){this.customerService=(0,e.WQX)(E.m),this.storage=(0,e.WQX)(x.n)}ngOnInit(){this.initForm(),this.registerSub=this.customerService.registerForm.subscribe({next:o=>{0==o?this.getData():1==o&&this.onSubmit()}})}initForm(){this.form=new r.gE({serial_no:new r.MJ(null,{validators:[r.k0.required]}),name:new r.MJ(null,{validators:[r.k0.required]}),email:new r.MJ(null,{validators:[r.k0.email]}),phone:new r.MJ(null,{validators:[r.k0.required,r.k0.minLength(10),r.k0.maxLength(10)]}),dob:new r.MJ(null,{validators:[r.k0.required]}),weight:new r.MJ(null,{validators:[r.k0.required]}),gender:new r.MJ(null,{validators:[r.k0.required]}),feet:new r.MJ(null,{validators:[r.k0.required]}),inches:new r.MJ(null,{validators:[r.k0.required]}),address:new r.MJ(null,{validators:[r.k0.required]}),membership_type:new r.MJ(null,{validators:[r.k0.required]}),guardian_name:new r.MJ(null,{validators:[r.k0.required]}),guardian_relation:new r.MJ(null,{validators:[r.k0.required]}),guardian_phone:new r.MJ(null,{validators:[r.k0.required,r.k0.minLength(10),r.k0.maxLength(10)]})})}getData(){var o=this;return(0,S.A)(function*(){const t=yield o.storage.getStorage(P.D.BASIC_FORM);if(null!=t&&t.value){const m=JSON.parse(t.value);o.form.patchValue({...m})}else o.form.reset()})()}onSubmit(){this.form.valid?(this.storage.setStorage(P.D.BASIC_FORM,JSON.stringify(this.form.value)),this.customerService.updateFormValue(2)):this.form.markAllAsTouched()}ngOnDestroy(){console.log("ngondestroy basic form"),this.registerSub&&this.registerSub.unsubscribe()}}return(a=v).\u0275fac=function(o){return new(o||a)},a.\u0275cmp=e.VBU({type:a,selectors:[["app-basic-form"]],standalone:!0,features:[e.aNF],decls:81,vars:23,consts:[[3,"formGroup"],[1,"form-row"],["sizeLg","6","sizeMd","6","sizeSm","12","sizeXl","6","sizeXs","12"],[1,"col-input"],["label","ID No.","labelPlacement","floating","type","number","formControlName","serial_no","errorText","* Please serial no."],["label","NAME","labelPlacement","floating","type","text","formControlName","name","errorText","* Please enter proper name."],["label","EMAIL","labelPlacement","floating","formControlName","email","type","email",3,"errorText"],["label","PHONE","labelPlacement","floating","formControlName","phone","type","number",3,"errorText"],["lines","none"],["slot","end","datetime","datetime"],[3,"keepContentsMounted"],["label","GENDER","labelPlacement","fixed","formControlName","gender","interface","popover","placeholder","Select Gender"],["value","M"],["value","F"],["value","T"],[1,"error"],["label","WEIGHT","labelPlacement","floating","formControlName","weight","type","number","placeholder","Enter weight","errorText","* Please provide your current body weight"],["slot","end"],["formControlName","feet","label","HEIGHT","labelPlacement","stacked",3,"min","max","step","value","pin","ticks","snaps"],["slot","start"],["formControlName","inches","label","","labelPlacement","stacked",3,"min","max","step","value","pin","ticks","snaps"],["label","ADDRESS","labelPlacement","floating","rows","1","formControlName","address","errorText","* Please provide your address",3,"autoGrow"],["label","MEMBERSHIP TYPE","labelPlacement","stacked","formControlName","membership_type","placeholder","Select type","interface","popover"],["value","Monthly"],["value","Quarterly"],["value","Half-yearly"],["value","Yearly"],["mode","md"],[1,"ion-margin"],["label","NAME","labelPlacement","floating","type","text","formControlName","guardian_name","errorText","* Please enter proper name."],["label","PHONE","labelPlacement","floating","formControlName","guardian_phone","type","number",3,"errorText"],["label","RELATION","labelPlacement","floating","type","text","formControlName","guardian_relation","errorText","* Please enter your relation"],["id","datetime","presentation","date","formControlName","dob",3,"showDefaultButtons"]],template:function(o,t){1&o&&(e.j41(0,"form",0)(1,"ion-row",1)(2,"ion-col",2)(3,"div",3),e.nrm(4,"ion-input",4),e.k0s()(),e.j41(5,"ion-col",2)(6,"div",3),e.nrm(7,"ion-input",5),e.k0s()(),e.j41(8,"ion-col",2)(9,"div",3),e.nrm(10,"ion-input",6),e.k0s()(),e.j41(11,"ion-col",2)(12,"div",3),e.nrm(13,"ion-input",7),e.k0s()(),e.j41(14,"ion-col",2)(15,"ion-item",8)(16,"ion-label"),e.EFF(17,"Date of Birth"),e.k0s(),e.nrm(18,"ion-datetime-button",9),e.j41(19,"ion-modal",10),e.DNE(20,T,1,1,"ng-template"),e.k0s()()(),e.j41(21,"ion-col",2)(22,"div",3)(23,"ion-select",11)(24,"ion-select-option",12),e.EFF(25,"Male"),e.k0s(),e.j41(26,"ion-select-option",13),e.EFF(27,"Female"),e.k0s(),e.j41(28,"ion-select-option",14),e.EFF(29,"Transgender"),e.k0s()(),e.DNE(30,k,2,0,"div",15),e.k0s()(),e.j41(31,"ion-col",2)(32,"div",3)(33,"ion-input",16)(34,"div",17),e.EFF(35,"kgs"),e.k0s()()()(),e.j41(36,"ion-col",2)(37,"div",3)(38,"ion-range",18)(39,"div",19),e.EFF(40,"3"),e.k0s(),e.j41(41,"div",17),e.EFF(42,"8"),e.k0s(),e.j41(43,"div",17),e.EFF(44,"feet"),e.k0s()(),e.j41(45,"ion-range",20)(46,"div",19),e.EFF(47,"0"),e.k0s(),e.j41(48,"div",17),e.EFF(49,"12"),e.k0s(),e.j41(50,"div",17),e.EFF(51,"inch"),e.k0s()(),e.DNE(52,R,2,0,"div",15),e.k0s()(),e.j41(53,"ion-col",2)(54,"div",3),e.nrm(55,"ion-textarea",21),e.k0s()(),e.j41(56,"ion-col",2)(57,"div",3)(58,"ion-select",22)(59,"ion-select-option",23),e.EFF(60,"Monthly"),e.k0s(),e.j41(61,"ion-select-option",24),e.EFF(62,"Quarterly"),e.k0s(),e.j41(63,"ion-select-option",25),e.EFF(64,"Half-yearly"),e.k0s(),e.j41(65,"ion-select-option",26),e.EFF(66,"Yearly"),e.k0s()(),e.DNE(67,j,2,0,"div",15),e.k0s()()(),e.j41(68,"ion-item-divider",27)(69,"ion-label"),e.EFF(70,"GUARDIAN/EMERGENCY CONTACT"),e.k0s()(),e.j41(71,"ion-row",28)(72,"ion-col",2)(73,"div",3),e.nrm(74,"ion-input",29),e.k0s()(),e.j41(75,"ion-col",2)(76,"div",3),e.nrm(77,"ion-input",30),e.k0s()(),e.j41(78,"ion-col",2)(79,"div",3),e.nrm(80,"ion-input",31),e.k0s()()()()),2&o&&(e.Y8G("formGroup",t.form),e.R7$(10),e.Y8G("errorText",t.form.get("email").hasError("email")?"* Please enter proper email address.":"* Please enter your Email Address"),e.R7$(3),e.Y8G("errorText",t.form.get("phone").hasError("minlength")||t.form.get("phone").hasError("maxlength")?"* Please enter your 10 digits Phone number.":"* Please enter your Phone number"),e.R7$(6),e.Y8G("keepContentsMounted",!0),e.R7$(11),e.vxM(t.form.get("gender").touched&&t.form.get("gender").hasError("required")?30:-1),e.R7$(8),e.Y8G("min",3)("max",8)("step",1)("value",5)("pin",!0)("ticks",!0)("snaps",!0),e.R7$(7),e.Y8G("min",0)("max",12)("step",1)("value",0)("pin",!0)("ticks",!0)("snaps",!0),e.R7$(7),e.vxM(t.form.get("feet").touched&&t.form.get("feet").hasError("required")||t.form.get("inches").touched&&t.form.get("inches").hasError("required")?52:-1),e.R7$(3),e.Y8G("autoGrow",!0),e.R7$(12),e.vxM(t.form.get("membership_type").touched&&t.form.get("membership_type").hasError("required")?67:-1),e.R7$(10),e.Y8G("errorText",t.form.get("guardian_phone").hasError("minlength")||t.form.get("guardian_phone").hasError("maxlength")?"* Please enter your 10 digits Emergency Phone number.":"* Please enter your Emergency Phone number"))},dependencies:[u.Sb,u.K4,u.A9,u.he,u.Dg,u.uz,u.Ob,u.hU,u.ln,u.$w,u.Nm,u.Ip,u.nc,r.X1,r.qT,r.BC,r.cb,r.j4,r.JD]}),v})();function s(a,v){if(1&a){const p=e.RV6();e.j41(0,"ion-col",2)(1,"div")(2,"ion-item",7)(3,"ion-label")(4,"ion-text"),e.EFF(5),e.k0s(),e.j41(6,"p")(7,"ion-radio-group",8),e.mxI("ngModelChange",function(t){const m=e.eBV(p).$implicit;return e.DH7(m.answer,t)||(m.answer=t),e.Njj(t)}),e.j41(8,"ion-radio",9),e.EFF(9,"Yes"),e.k0s(),e.j41(10,"ion-radio",10),e.EFF(11,"No"),e.k0s()()()()()()()}if(2&a){const p=v.$implicit;e.R7$(5),e.SpI(" ",null==p?null:p.question," "),e.R7$(2),e.R50("ngModel",p.answer),e.Y8G("name",p.name)}}let i=(()=>{var a;class v{constructor(){this.actualData=[],this.data=[],this.model={},this.customerService=(0,e.WQX)(E.m),this.storage=(0,e.WQX)(x.n)}ngOnInit(){this.actualData=[{id:1,question:"Have you ever had heart issues or chest pain during exercise?",name:"heart_issue",answer:"no"},{id:2,question:"Any current medications or medical conditions impacting your exercise ability?",name:"current_medication",answer:"no"},{id:3,question:"Have you ever had surgery, injury or joint problems?",name:"joint_problem",answer:"no"},{id:4,question:"Are you currently pregnant or have given birth within the last 6 weeks?",name:"pregnant",answer:"no"},{id:5,question:"Any respiratory conditions like asthma or COPD?",name:"respiratory_condition",answer:"no"},{id:6,question:"Do you currently exercise regularly?",name:"regular_exercise",answer:"no"},{id:7,question:"Smoke or quit smoking in the last 6 months?",name:"smoke",answer:"no"},{id:8,question:"Regular or excessive alcohol consumption?",name:"alcohol",answer:"no"},{id:9,question:"Have your doctor ever said that you have a heart condition & you should only do physical activity recommended by a doctor?",name:"recommend_by_doctor",answer:"no"},{id:10,question:"Do you feel in your chest when you do physical activity?",name:"feel_chest",answer:"no"},{id:11,question:"In the past month, have you had chest pain when you were not doing physical activity?",name:"past_month",answer:"no"},{id:12,question:"Do you lose balance because of dizziness or do you ever lose consciousness?",name:"dizzy",answer:"no"},{id:13,question:"Do you have bone or joint problem (for example, back, knee, or hip) that could be worsen by a change in your physical activity?",name:"joint_problem",answer:"no"},{id:14,question:"Is your doctor currently prescribing drugs (for example water pills) for your blood pressure or heart condition?",name:"prescribe_drugs",answer:"no"},{id:15,question:"Do you know of any other reason why you should not do physical activity?",name:"other_reason",answer:"no"}],this.data=[...this.actualData],this.registerSub=this.customerService.registerForm.subscribe({next:o=>{console.log(o),2==o?this.getData():3==o&&this.onSubmit()}})}getData(){var o=this;return(0,S.A)(function*(){const t=yield o.storage.getStorage(P.D.HEALTH_FORM);if(null!=t&&t.value){const m={...JSON.parse(t.value)};o.data=m.health_questionaire,o.model={marked_problem:(null==m?void 0:m.marked_problem)||"",other_issue:(null==m?void 0:m.other_issue)||"",drugs:(null==m?void 0:m.drugs)||""}}else o.model={},o.data=[...o.actualData]})()}onSubmit(){if(this.healthForm.invalid)return;console.log("data selected: ",this.data);const o={health_questionaire:this.data,...this.model};this.storage.setStorage(P.D.HEALTH_FORM,JSON.stringify(o)),this.customerService.updateFormValue(4)}ngOnDestroy(){console.log("ngondestroy health form"),this.registerSub&&this.registerSub.unsubscribe()}}return(a=v).\u0275fac=function(o){return new(o||a)},a.\u0275cmp=e.VBU({type:a,selectors:[["app-health-form"]],viewQuery:function(o,t){if(1&o&&e.GBs(r.cV,5),2&o){let m;e.mGM(m=e.lsd())&&(t.healthForm=m.first)}},standalone:!0,features:[e.aNF],decls:15,vars:9,consts:[["healthForm","ngForm"],[1,"ion-margin"],["sizeLg","6","sizeMd","6","sizeSm","12","sizeXl","6","sizeXs","12"],[1,"ion-margin","inputs"],["label","Kindly elaborate your marked problems:","labelPlacement","floating","name","marked_problem",3,"ngModelChange","autoGrow","rows","ngModel"],["label","Any other issues related to your health:","labelPlacement","floating","name","other_issue",3,"ngModelChange","autoGrow","rows","ngModel"],["label","Drugs / Medications, if Any:","labelPlacement","floating","name","drugs",3,"ngModelChange","autoGrow","rows","ngModel"],["lines","none"],["mode","md","required","",3,"ngModelChange","ngModel","name"],["value","yes","labelPlacement","fixed"],["value","no","labelPlacement","fixed"]],template:function(o,t){if(1&o){const m=e.RV6();e.j41(0,"form",null,0)(2,"ion-row",1),e.Z7z(3,s,12,3,"ion-col",2,e.Vm6),e.k0s(),e.j41(5,"ion-row",3)(6,"ion-col",2)(7,"ion-item")(8,"ion-textarea",4),e.mxI("ngModelChange",function(F){return e.eBV(m),e.DH7(t.model.marked_problem,F)||(t.model.marked_problem=F),e.Njj(F)}),e.k0s()()(),e.j41(9,"ion-col",2)(10,"ion-item")(11,"ion-textarea",5),e.mxI("ngModelChange",function(F){return e.eBV(m),e.DH7(t.model.other_issue,F)||(t.model.other_issue=F),e.Njj(F)}),e.k0s()()(),e.j41(12,"ion-col",2)(13,"ion-item")(14,"ion-textarea",6),e.mxI("ngModelChange",function(F){return e.eBV(m),e.DH7(t.model.drugs,F)||(t.model.drugs=F),e.Njj(F)}),e.k0s()()()()()}2&o&&(e.R7$(3),e.Dyx(t.data),e.R7$(5),e.Y8G("autoGrow",!0)("rows",1),e.R50("ngModel",t.model.marked_problem),e.R7$(3),e.Y8G("autoGrow",!0)("rows",1),e.R50("ngModel",t.model.other_issue),e.R7$(3),e.Y8G("autoGrow",!0)("rows",1),e.R50("ngModel",t.model.drugs))},dependencies:[u.nc,u.IO,u.he,u.uz,u.KO,u.f0,u.hU,u.ln,r.YN,r.qT,r.BC,r.cb,r.YS,r.vS,r.cV],styles:["ion-col[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px}ion-col[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--border-radius: 10px}ion-col[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-size:1rem}ion-row.inputs[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--border-radius: 10px}@media screen and (min-width: 768px) and (max-width: 1381px){.ios[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], .md[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{height:21vh!important}}@media screen and (min-width: 1382px) and (max-width: 1400px){.ios[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], .md[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{height:10vh!important}}"]}),v})();var n=y(3202),d=y(5079),_=y(5873);function f(a,v){1&a&&(e.j41(0,"ion-item-divider",6)(1,"ion-label"),e.EFF(2,"HEALTH QUESTIONAIRE"),e.k0s()())}function g(a,v){if(1&a){const p=e.RV6();e.j41(0,"ion-card")(1,"ion-item",7)(2,"ion-label"),e.EFF(3," Take a selfie "),e.j41(4,"p"),e.EFF(5," Your photo is needed for face recognition "),e.k0s()(),e.j41(6,"ion-thumbnail",8),e.bIt("click",function(){e.eBV(p);const t=e.XpG();return e.Njj(t.takePicture())}),e.nrm(7,"ion-img",9),e.k0s()(),e.nrm(8,"app-basic-form"),e.k0s()}if(2&a){const p=e.XpG();e.R7$(7),e.Y8G("src",p.photo?"data:image/png;base64,"+p.photo.base64String:"assets/imgs/avatar.png")}}function h(a,v){1&a&&e.nrm(0,"app-health-form")}function b(a,v){if(1&a){const p=e.RV6();e.j41(0,"ion-col")(1,"ion-button",10),e.bIt("click",function(){e.eBV(p);const t=e.XpG();return e.Njj(t.previous())}),e.EFF(2,"PREVIOUS"),e.k0s()(),e.j41(3,"ion-col")(4,"ion-button",11),e.bIt("click",function(){e.eBV(p);const t=e.XpG();return e.Njj(t.register())}),e.EFF(5,"REGISTER"),e.k0s()()}}function c(a,v){if(1&a){const p=e.RV6();e.j41(0,"ion-col")(1,"ion-button",12),e.bIt("click",function(){e.eBV(p);const t=e.XpG();return e.Njj(t.next())}),e.EFF(2,"NEXT"),e.k0s()()}}let M=(()=>{var a;class v{constructor(){this.form_type=0,this.customerService=(0,e.WQX)(E.m),this.storage=(0,e.WQX)(x.n),this.global=(0,e.WQX)(n.d),(0,d.a)({trashBinOutline:_.Cw8})}ngOnInit(){this.registerSub=this.customerService.registerForm.subscribe({next:o=>{console.log(o),this.form_type=o,2==o?this.scrollToTop():4==o&&this.save()}})}scrollToTop(){this.content.scrollToTop(500)}previous(){this.customerService.updateFormValue(0)}next(){this.photo?this.customerService.updateFormValue(1):this.global.errorToast("Take a selfie")}register(){this.customerService.updateFormValue(3)}takePicture(){var o=this;return(0,S.A)(function*(){o.photo=yield o.global.takePicture(!0)})()}save(){var o=this;return(0,S.A)(function*(){try{o.global.showLoader();let t={};const m=yield o.storage.getStorage(P.D.BASIC_FORM);if(null!=m&&m.value){const w=JSON.parse(m.value);t={...t,...w,short_name:null==w?void 0:w.name.toLowerCase()}}const C=yield o.storage.getStorage(P.D.HEALTH_FORM);if(null!=C&&C.value){const w=JSON.parse(C.value);t={...t,health:w}}const F=new Date;t={...t,created_at:F,updated_at:F,status:!0},console.log(t);const N=yield o.global.getBlob(o.photo.base64String),I=yield o.customerService.registerStudent(t,o.photo,N);console.log(I),o.global.hideLoader(),o.global.successToast("Student Registered Successfully"),o.reset()}catch(t){console.log(t),o.global.hideLoader(),"exists"==(null==t?void 0:t.code)?o.global.errorToast(t.message):o.global.checkMessageForErrorToast(t)}})()}reset(){this.storage.removeStorage(P.D.BASIC_FORM),this.storage.removeStorage(P.D.HEALTH_FORM),this.photo=null,this.customerService.updateFormValue(0)}ngOnDestroy(){console.log("ngondestroy register"),this.registerSub&&this.registerSub.unsubscribe()}}return(a=v).\u0275fac=function(o){return new(o||a)},a.\u0275cmp=e.VBU({type:a,selectors:[["app-student-register"]],viewQuery:function(o,t){if(1&o&&e.GBs(u.W9,5),2&o){let m;e.mGM(m=e.lsd())&&(t.content=m.first)}},standalone:!0,features:[e.aNF],decls:18,vars:3,consts:[["color","primary"],["slot","start"],["defaultHref","/tabs/students"],["slot","end"],[3,"click"],["name","trash-bin-outline"],["mode","md"],["lines","none",1,"ion-margin","pic"],["slot","end",3,"click"],[3,"src"],["expand","block","color","light",3,"click"],["expand","block","color","success",3,"click"],["expand","block","color","tertiary",3,"click"]],template:function(o,t){1&o&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e.EFF(3,"Registration Form"),e.k0s(),e.j41(4,"ion-buttons",1),e.nrm(5,"ion-back-button",2),e.k0s(),e.j41(6,"ion-buttons",3)(7,"ion-button",4),e.bIt("click",function(){return t.reset()}),e.nrm(8,"ion-icon",5),e.k0s()()()(),e.j41(9,"ion-content",0),e.DNE(10,f,3,0,"ion-item-divider",6)(11,g,9,1,"ion-card")(12,h,1,0,"app-health-form"),e.k0s(),e.j41(13,"ion-footer")(14,"ion-toolbar",0)(15,"ion-row"),e.DNE(16,b,6,0)(17,c,3,0,"ion-col"),e.k0s()()()),2&o&&(e.R7$(10),e.vxM(t.form_type>=2?10:-1),e.R7$(),e.vxM(t.form_type<2?11:t.form_type>=2?12:-1),e.R7$(5),e.vxM(t.form_type>=2?16:17))},dependencies:[u.iq,u.QW,u.el,u.KW,u.he,u.Dg,u.uz,u.hU,u.ln,u.M0,u.b_,u.eU,u.W9,u.ai,u.BC,u.Jm,u.Zx,l,i]}),v})()},1583:(O,D,y)=>{y.d(D,{m:()=>T});var S=y(467),e=y(9642),u=y(3953),r=y(9967),P=y(4412),E=y(1985),x=y(1339);let T=(()=>{var k;class R{get registerForm(){return this._registerForm.asObservable()}get students(){return this._students.asObservable()}get member(){return this._member.asObservable()}constructor(){this.expiry_days_count=365,this._registerForm=new P.t(0),this._students=new P.t([]),this._member=new P.t(null),this.apiService=(0,u.WQX)(e.G),this.auth=(0,u.WQX)(x.u)}updateFormValue(l){this._registerForm.next(l)}uploadPhoto(l,s){var i=this;return(0,S.A)(function*(){try{const n=Date.now();console.log(s);const d=`students/${n}.${l.format}`;return yield i.apiService.uploadImage(s,d)}catch(n){throw n}})()}registerStudent(l,s,i){var n=this;return(0,S.A)(function*(){try{const d=n.apiService.collectionFirestoreRef("students"),_=(0,r.P)(d,(0,r.or)(n.apiService.whereQuery("email","==",null==l?void 0:l.email),n.apiService.whereQuery("phone","==",null==l?void 0:l.phone))),g=yield(yield n.apiService.getDocsByQuery(_)).docs.map(a=>a.data());if((null==g?void 0:g.length)>0)throw{code:"exists",message:"Student already registered with same email or phone number"};const h=yield n.uploadPhoto(s,i),b={...l,photo:h},c=yield n.apiService.addDocument("students",b);let M=[{...b,id:null==c?void 0:c.id},...n._students.value];return n._students.next(M),c}catch(d){throw d}})()}getStudents(l,s,i){var n=this;return(0,S.A)(function*(){try{if(!(yield n.auth.getId()))throw"Unauthorized user";i||(n.lastVisible=null);const _=n.apiService.collectionFirestoreRef("students");let f=(0,r.P)(_,n.apiService.orderByQuery("created_at","desc"),n.apiService.limitQuery(l));s&&(f=(0,r.P)(f,n.apiService.whereQuery("short_name",">=",s),n.apiService.whereQuery("short_name","<=",s+"\uf8ff"))),n.lastVisible&&i&&(f=(0,r.P)(f,n.apiService.startAfterQuery(n.lastVisible)));const g=yield n.apiService.getDocsByQuery(f);console.log(g);let h=[];g.docs.length>0&&(n.lastVisible=g.docs[g.docs.length-1],console.log("last",n.lastVisible),h=yield g.docs.map(c=>{let M=c.data();return M.id=c.id,M}));let b=[];return i?(console.log("orders",h),b=n._students.value||[],b=b.concat(h)):b=[...h],n._students.next(b),b}catch(d){throw d}})()}getStudentsCount(){var l=this;return(0,S.A)(function*(){try{return(yield l.apiService.getDocs("students")).size}catch(s){throw s}})()}getStudent(l){var s=this;return(0,S.A)(function*(){try{const i=yield s.apiService.getDocById(`students/${l}`);if(i.exists()){let n=i.data();return n.id=i.id,s._member.next(n),n}throw console.log("No such document!"),"No such document!"}catch(i){throw i}})()}updateMember(l,s,i,n){var d=this;return(0,S.A)(function*(){try{if(i){const h=yield d.uploadPhoto(i,n);s={...s,photo:h}}const _=yield d.apiService.updateDocument(`students/${l.id}`,s);console.log(_);let f=d._students.value||[];if(0==(null==f?void 0:f.length)){let h=d._member.value;return console.log("member data: ",h),h?(h={...h,...s},d._member.next(h),{...h,...s}):null}const g=f.findIndex(h=>h.id==l.id);return-1==g?null:(f[g]={...f[g],...s},d._students.next(f),d._member.next(f[g]),{...f[g]})}catch(_){throw _}})()}updateMemberValue(l,s=!0){const i=this._students.value;let n;if((null==i?void 0:i.length)>0){const d=i.findIndex(_=>_.id==(null==l?void 0:l.id));if(-1==d)return;i[d]={...i[d],...l},this._students.next(i),n=i[d]}else{if(n=this._member.value,!n)return;n={...n,...l}}s&&this._member.next(n)}updateMemberData(l,s){const i=this._students.value;let n;if(0==(null==i?void 0:i.length)){if(n=this._member.value,!n)return}else n=i.find(_=>_.id==l);const d={...n,...s};this._member.next(d),this.updateMemberValue(d,!1)}resetMember(){this._member.next(null)}getMemberData(l){var s=this;return(0,S.A)(function*(){try{let i=s._member.value;return i||(i=yield s.getStudent(l)),i}catch(i){throw i}})()}fetchMembersWithExpiringPlans(){return new E.c(l=>{const s=(new Date).toISOString(),i=new Date;i.setDate(i.getDate()+this.expiry_days_count);const n=i.toISOString(),d=this.apiService.collectionFirestoreRef("students"),_=(0,r.P)(d,this.apiService.whereQuery("gym_plan.expiry_date","<=",n),this.apiService.whereQuery("pt_plan.expiry_date","<=",n));return(0,r.aQ)(_,g=>{const h=[];g.docs.forEach(b=>{const c=b.data(),M=b.id,a=[];null!=c&&c.gym_plan&&c.gym_plan.expiry_date>=s&&c.gym_plan.expiry_date<=n&&a.push("GYM"),null!=c&&c.pt_plan&&(c.pt_plan.expiry_date>=s&&c.pt_plan.expiry_date<=n||c.pt_plan.sessions-c.pt_plan.sessions_used==0)&&a.push("PT"),a.length>0&&h.push({id:M,...c,expiringPlans:a})}),console.log(h),l.next(h)},g=>l.error(g))})}fetchMembersWithExpiredGymPlans(){var l=this;return(0,S.A)(function*(){try{const s=(new Date).toISOString(),i=l.apiService.collectionFirestoreRef("students"),n=(0,r.P)(i,l.apiService.whereQuery("gym_plan.expiry_date","<",s)),d=yield l.apiService.getDocsByQuery(n),_=[];return d.forEach(f=>{const g=f.data();_.push({id:f.id,...g})}),console.log(_),_}catch(s){throw console.error(s),s}})()}fetchMembersWithExpiredOrUsedUpPTPlans(){var l=this;return(0,S.A)(function*(){try{const s=(new Date).toISOString(),i=l.apiService.collectionFirestoreRef("students"),n=(0,r.P)(i,l.apiService.whereQuery("pt_plan.expiry_date","<=",s),l.apiService.whereQuery("pt_plan.sessions",">=",0)),d=yield l.apiService.getDocsByQuery(n),_=[];return d.forEach(f=>{var g,h,b;const c=f.data();(null==c?void 0:c.pt_plan)&&((null==c||null===(g=c.pt_plan)||void 0===g?void 0:g.expiry_date)<=s||(null==c||null===(h=c.pt_plan)||void 0===h?void 0:h.sessions)-(null==c||null===(b=c.pt_plan)||void 0===b?void 0:b.sessions_used)==0)&&_.push({id:f.id,...c})}),console.log(_),_}catch(s){throw console.error(s),s}})()}getDaysLeft(l){const s=new Date(l),i=new Date;s.setHours(0,0,0,0),i.setHours(0,0,0,0);const n=new Date;if(n.setDate(i.getDate()+this.expiry_days_count),i<=s&&s<=n){const d=s.getTime()-i.getTime();return Math.ceil(d/864e5)}return null}}return(k=R).\u0275fac=function(l){return new(l||k)},k.\u0275prov=u.jDH({token:k,factory:k.\u0275fac,providedIn:"root"}),R})()}}]);